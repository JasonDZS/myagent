<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan and Solve Flow Diagrams - Mermaid Test</title>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1, h2 {
            color: #333;
        }
        .diagram-container {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .mermaid {
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Plan and Solve Flow Diagrams</h1>
    <p>这个页面展示了 Plan and Solve agent 的各种流程图。</p>

    <div class="diagram-container">
        <h2>1. 整体状态流程图</h2>
        <div class="mermaid">
stateDiagram-v2
    [*] --> IDLE
    note right of IDLE: Agent Created

    IDLE --> PLANNING
    note right of PLANNING: run(question)

    state PLANNING {
        [*] --> AnalyzeProblem
        AnalyzeProblem --> CreatePlan
        CreatePlan --> ValidatePlan
        ValidatePlan --> StorePlan
        StorePlan --> [*]

        note right of AnalyzeProblem: Receive Question
        note right of CreatePlan: Use write_todos tool
        note right of ValidatePlan: Optional validate_plan
        note right of StorePlan: Plan Ready
    }

    PLANNING --> SOLVING
    note right of SOLVING: Plan Created

    state SOLVING {
        [*] --> CheckNextTask
        CheckNextTask --> MarkInProgress
        MarkInProgress --> ExecuteTool
        ExecuteTool --> RecordResult
        RecordResult --> MarkCompleted
        MarkCompleted --> CheckNextTask
        CheckNextTask --> [*]

        note right of CheckNextTask: Get Next Pending Task
        note right of MarkInProgress: Update Status
        note right of ExecuteTool: Tool Execution
        note right of MarkCompleted: Store Output
    }

    SOLVING --> VERIFYING
    note right of VERIFYING: All Steps Complete

    state VERIFYING {
        [*] --> CheckResults
        CheckResults --> ValidateAnswer
        ValidateAnswer --> FormatResponse
        FormatResponse --> [*]

        note right of CheckResults: Review Outputs
        note right of ValidateAnswer: Verify Calculations
        note right of FormatResponse: Final Answer Ready
    }

    VERIFYING --> FINISHED
    FINISHED --> [*]
    note right of FINISHED: terminate tool
        </div>
    </div>

    <div class="diagram-container">
        <h2>2. 任务状态转换图</h2>
        <div class="mermaid">
stateDiagram-v2
    [*] --> PENDING
    note right of PENDING: Task Created in Plan

    PENDING --> IN_PROGRESS
    note left of IN_PROGRESS: Agent Starts Task

    IN_PROGRESS --> COMPLETED
    note right of COMPLETED: Task Finished Successfully

    IN_PROGRESS --> FAILED
    note right of FAILED: Task Execution Error

    FAILED --> IN_PROGRESS
    FAILED --> SKIPPED

    COMPLETED --> [*]
    SKIPPED --> [*]
        </div>
    </div>

    <div class="diagram-container">
        <h2>3. 工具调用流程图（简化版）</h2>
        <div class="mermaid">
stateDiagram-v2
    [*] --> LLM_Think
    LLM_Think --> ToolSelection

    state ToolSelection {
        [*] --> IdentifyTool
        IdentifyTool --> ValidateParams
        ValidateParams --> [*]

        note right of IdentifyTool: Parse Tool Name
        note right of ValidateParams: Parse Arguments
    }

    ToolSelection --> CheckToolType

    state CheckToolType <<choice>>
    CheckToolType --> PlanningTool: write_todos
    CheckToolType --> DomainTool: calculator
    CheckToolType --> SpecialTool: terminate

    PlanningTool --> AddToMemory
    DomainTool --> AddToMemory
    SpecialTool --> AddToMemory

    AddToMemory --> NextStep
    NextStep --> [*]
        </div>
    </div>

    <footer style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; text-align: center; color: #666;">
        <p>Generated from myagent Plan and Solve documentation</p>
    </footer>
</body>
</html>
